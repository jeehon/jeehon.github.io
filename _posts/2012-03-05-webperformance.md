---
id: 1078
title: 网站性能优化实战一
date: 2012-03-05T10:19:01+00:00
author: jeehon
layout: post
categories:
  - 分享
  - 学习
  - 性能
tags:
  - Expires头
  - HTTP请求
  - Web性能
  - 性能优化
---
当你搭建一个网站时，有一个很重要的因素必须要考虑，这就是网站的性能。

作为一名从事后端开发的程序员，之前我都会关注算法的优劣、程序中变量的优化、循环语句优化、避免不必要的函数调用、SQL语句的性能等，而在你真正搭建一个网站时，在这些方面能做的事情很少，而且收到的效果也不会很明显。譬如当你用wordpress搭建一个个人博客时，在后端，你能做的事情只是尽量避免不必要的函数调用、尽量少使用全局变量、对多重循环语句进行优化等，但是这些对于网站呈现来说，效果并不是很明显。所以在对网站进行性能优化时，我们应该找到主要的因素，才能有效的改善性能。

在开始正文之前，先了解一下性能黄金法则：

> 只有10%~20%的最终用户响应时间花在了下载HTML文档上，其余的80%~90%时间花在了下载页面中的所有组件上。

如果希望能够有效的减少网站页面的响应时间，就必须从80%~90%的这些时间上下手。
  
<!--more-->

## 减少HTTP请求

**1.CSS Sprites**
  
我们知道，每一张图片都会产生一个HTTP请求。图片相比于文字可以传达更多、更友好的信息，所以我们都喜欢在自己的网站里放置很多的图片，这样一来就出产生非常多的HTTP请求，影响网站的加载速度，但是我们又不想不用它们，这时候CSS Sprites(常被叫做雪碧图)就会帮到你。将网站上比较小的图标、图片文件组合在一张图片中，然后通过CSS来定位每一张图片的位置是CSS Sprites的思想。这样一来，多个HTTP请求就变成一个了，自然会使网站的加载速度变快。本人的[首页](http://jeehon.info)就用到了雪碧图，图片如下所示：
  
![BG](http://jeehon.info/wp-content/themes/pic-home/images/ico.png)
  
**2.合并脚本和样式表**
  
这个就不用怎么说了，我们一般都只使用一个样式表文件并且尽量合并能够合并的脚本(没有脚本就更好了)。

## 通过添加长久的Expires头来缓存组件

由于浏览器会使用缓存来减少HTTP请求的数量和响应的大小，从而使Web页面加载的更快，所以我们可以在Web服务器中使用Expires头来告诉客户端的浏览器在第一次加载页面时缓存页面中的组件，缓存到指定的时间。

这样，客户端只是在第一次加载页面时会向服务器发送各个组件的HTTP请求，在以后组件缓存时间没有到期之前，都会读本地缓存，就减少了很多HTTP请求，如果你的站点有很多不经常变化的图片、脚本、样式表或者Flash组件，通过添加Expires头就会给站点加载节省很多时间。

给组件添加长久的Expires头有两个问题需要考虑：

  * 添加Expires头需要配置Web服务器，所以你需要有权限来配置它。
  
    目前比较流行的Web服务器有Apache和IIS，如果你获得了配置服务器的权限，就可以参照相关的规则进行配置。我搜索了两个简单的配置向导网页：1.[Apache修改服务器头部Expires.](http://linuxso.com/linuxrumen/4953.html)2.[IIS设置HTTP头.](http://blog.webluker.com/dns_cdn/1048.html)
  * 如果我们将组件缓存在用户电脑中，在缓存日期没有结束之前，当组件改变时，用户如何获得更新呢？
  
    如果缓存组件，一定会遇到这个问题。为了保证用户能够获得最新的组件版本，我们需要对组件名称做一些修改，当组件发生改变时，组件名发生变化，浏览器就会发出新的HTTP请求，此时我们可以用一种比较轻松的方式来应对组件名称的修改，就是在组件名中加入版本信息，就像[33号铺](http://33pu.net/)里面组件的命名规则一样：http://33pu.net/wp-content/plugins/inform-admin/js/inform-admin.js?ver=3.3。

## 通过压缩组件来减少HTTP请求和响应时间

我们也可以通过压缩组件，减少网络传输中组件的大小来减少HTTP请求和响应的时间，从而加快页面的加载。我们知道对文本进行压缩之后，会使文本占用的空间大大减小，所以如果我们把网站的脚本和样式表压缩之后从服务器传递到客户端就会减少HTTP请求和响应的时间。

压缩组件也会遇到和添加Expires头一样的问题：需要获得服务器配置权限。如果获得了权限，就可以根据相应的规则进行配置，我也搜索了IIS和Apache如何配置的网页：1.[Apache启用html gzip压缩方法。](http://bbs.linuxtone.org/home.php?mod=space&uid=11671&do=blog&id=295)2.[IIS开启GZIP压缩部署方法。](http://www.cnblogs.com/parry/archive/2010/10/26/How_To_Gzip.html)